<UserControl x:Class="XueQiaoWaf.Trade.Modules.Presentation.Views.PlaceOrderHangingOrdersAreaView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:convert="clr-namespace:XueQiaoFoundation.BusinessResources.Converters;assembly=XueQiaoFoundation.BusinessResources"
             xmlns:uiconvert="clr-namespace:XueQiaoFoundation.UI.Converters;assembly=XueQiaoFoundation.UI"
             xmlns:uiextra_convert="clr-namespace:XueQiaoFoundation.UI.Extra.converter;assembly=XueQiaoFoundation.UI.Extra"
             xmlns:hosting_arbitrage="clr-namespace:xueqiao.trade.hosting.arbitrage.thriftapi;assembly=IDLAutoGenerated"
             xmlns:native_trade="clr-namespace:NativeModel.Trade;assembly=NativeModel"
             xmlns:vm="clr-namespace:XueQiaoWaf.Trade.Modules.Applications.ViewModels;assembly=XueQiaoWaf.Trade.Modules.Applications"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:adorners="http://gu.se/Adorners"
             mc:Ignorable="d" 
             d:DesignWidth="300"
             d:DesignHeight="300" 
             d:DataContext="{x:Type vm:PlaceOrderHangingOrdersAreaVM}"
             x:Name="ViewRoot">
    <UserControl.Resources>
        <uiextra_convert:Timestamp2StringConverter x:Key="TimestampMs2TimeStringConverter" 
                                           ValueType="Millisecond" 
                                           Convert2StringFormatType="Time"/>
        <convert:TradeDirection2NameConverter x:Key="TradeDirection2NameConverter"/>
        <convert:ClientXQOrderState2NameConverter x:Key="OrderState2NameConverter"/>
        <convert:HostingXQSuspendReasonDescConverter x:Key="HostingXQSuspendReasonDescConverter"/>
        <uiconvert:EqualityToVisibilityConverter x:Key="Equal2VisibleConverter"
                                                 CollapsedWhenEquals="False"
                                                 CollapsedWhenNotEquals="True"/>
        <uiconvert:EqualityToBooleanConverter x:Key="Equal2BoolConverter"/>
        <sys:Boolean x:Key="TrueValue">True</sys:Boolean>

        <DataGridTextColumn Binding="{Binding Direction, Converter={StaticResource TradeDirection2NameConverter}}"
                            Header="方向"
                            CanUserSort="False"
                            MinWidth="40"
                            x:Key="OrderListColumn_Direction"
                            x:Shared="False"/>
        <DataGridTemplateColumn Header="状态"
                                CanUserSort="False"
                                MinWidth="62"
                                x:Key="OrderListColumn_OrderState"
                                x:Shared="False">
            <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                    <Grid>
                        <TextBlock 
                            Text="{Binding OrderState, Converter={StaticResource OrderState2NameConverter}}"
                            Foreground="{DynamicResource ContentBrush1}"
                            x:Name="StateTextBlock"/>
                        <Path Fill="{DynamicResource ContentBrush1}"
                              Visibility="Collapsed"
                              HorizontalAlignment="Right"
                              VerticalAlignment="Top"
                              Margin="0,-4,-4,0"
                              x:Name="ShowSuspendReasonTriggerControl">
                            <Path.Data>
                                <PathGeometry>
                                    <PathFigure IsClosed="True" StartPoint="0,0">
                                        <LineSegment Point="8,0"/>
                                        <LineSegment Point="8,8"/>
                                    </PathFigure>
                                </PathGeometry>
                            </Path.Data>
                            <Path.ToolTip>
                                <ToolTip Style="{StaticResource XQToolTipStyle}" >
                                    <ToolTip.Content>
                                        <MultiBinding Converter="{StaticResource HostingXQSuspendReasonDescConverter}" Mode="OneWay" TargetNullValue="{StaticResource NullValueDataDefaultDisplayText}">
                                            <Binding Path="OrderStateDetail.SuspendReason"/>
                                            <Binding Path="OrderStateDetail.SuspendedErrorCode"/>
                                        </MultiBinding>
                                    </ToolTip.Content>
                                </ToolTip>
                            </Path.ToolTip>
                        </Path>
                    </Grid>
                    <DataTemplate.Triggers>
                        <DataTrigger Binding="{Binding OrderStateDetail.StateValue}" Value="{x:Static hosting_arbitrage:HostingXQOrderStateValue.XQ_ORDER_SUSPENDED}">
                            <Setter TargetName="ShowSuspendReasonTriggerControl" Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding OrderStateDetail.SuspendReason}" Value="{x:Static hosting_arbitrage:HostingXQSuspendReason.SUSPENDED_ERROR_OCCURS}">
                            <Setter TargetName="StateTextBlock" Property="Foreground" Value="{DynamicResource ContentBrush3}"/>
                            <Setter TargetName="ShowSuspendReasonTriggerControl" Property="Fill" Value="{DynamicResource ErrorBrush1}"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding OrderStateDetail.SuspendReason}" Value="{x:Static hosting_arbitrage:HostingXQSuspendReason.SUSPENDED_BY_PERSON}">
                            <Setter TargetName="StateTextBlock" Property="Foreground" Value="{DynamicResource ContentBrush3}"/>
                            <Setter TargetName="ShowSuspendReasonTriggerControl" Property="Fill" Value="{DynamicResource MinorBrush1}"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding OrderStateDetail.SuspendReason}" Value="{x:Static hosting_arbitrage:HostingXQSuspendReason.SUSPENDED_FUNCTIONAL}">
                            <Setter TargetName="StateTextBlock" Property="Foreground" Value="{DynamicResource ContentBrush3}"/>
                            <Setter TargetName="ShowSuspendReasonTriggerControl" Property="Fill" Value="{DynamicResource ContentBrush3}"/>
                        </DataTrigger>
                    </DataTemplate.Triggers>
                </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>

        <DataGridTextColumn Binding="{Binding Price}"
                            Header="价格"
                            CanUserSort="False"
                            MinWidth="68"
                            x:Key="OrderListColumn_Price"
                            x:Shared="False"/>

        <DataGridTextColumn Binding="{Binding Quantity}"
                            Header="数量"
                            MinWidth="44"
                            CanUserSort="False"
                            x:Key="OrderListColumn_Quantity"
                            x:Shared="False"/>

        <DataGridTemplateColumn 
            Header="腿成交概要" 
            CanUserSort="False"
            MinWidth="100"
            x:Key="OrderListColumn_ComposeLegTradeSummary"
            x:Shared="False">
            <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                    <ContentControl Content="{Binding TargetComposeLegTradeSummarysContainer}" 
                                    ContentTemplate="{StaticResource TargetComposeLegTradeSummarysTextDT}"/>
                </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>

    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                Background="{DynamicResource PanelHeaderBgBrush1}">
            <DockPanel Margin="4" >
                <Button 
                        DockPanel.Dock="Left" 
                        Content="全选" 
                        Style="{StaticResource FlatContentButtonPrimary3}"
                        Click="SelectAllOrderItems"/>
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right"
                            Margin="20,0,0,0">
                    <Button 
                        Content="强追" 
                        Style="{StaticResource FlatContentButtonPrimary3}"
                        Command="{Binding SelectedOrdersOptCommands.StrongChaseSelectedOrdersCmd}"
                        Visibility="{Binding TargetType, 
                                    Converter={StaticResource Equal2VisibleConverter}, 
                                    ConverterParameter={x:Static native_trade:ClientXQOrderTargetType.COMPOSE_TARGET}}"/>
                    <Button 
                        Margin="10,0,0,0"
                        Content="启动" 
                        Style="{StaticResource FlatContentButtonPrimary3}"
                        Command="{Binding SelectedOrdersOptCommands.ResumeSelectedOrdersCmd}"/>
                    <Button 
                        Margin="10,0,0,0"
                        Content="暂停" 
                        Style="{StaticResource FlatContentButtonPrimary3}"
                        Command="{Binding SelectedOrdersOptCommands.SuspendSelectedOrdersCmd}"/>
                    <Button 
                        Content="撤单" 
                        Style="{StaticResource FlatContentButtonPrimary3}"
                        Margin="10,0,0,0"
                        Command="{Binding SelectedOrdersOptCommands.RevokeSelectedOrdersCmd}"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <DataGrid 
            Grid.Row="1"
            DockPanel.Dock="Bottom"
            IsReadOnly="true"
            ItemsSource="{Binding CurrentItemOrderListView}"
            SelectionMode="Extended"
            MouseDown="OrdersDataGrid_MouseDown" 
            x:Name="OrdersDataGrid">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="SelectionChanged">
                    <i:InvokeCommandAction 
                            Command="{Binding SelectedOrdersOptCommands.OrderItemsSelectionChangedCmd}" 
                            CommandParameter="{Binding SelectedItems, ElementName=OrdersDataGrid}"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow" BasedOn="{StaticResource DataGridRowDefault}">
                    <Setter Property="adorners:Info.IsVisible">
                        <Setter.Value>
                            <MultiBinding Converter="{StaticResource Equal2BoolConverter}" Mode="OneWay">
                                <Binding RelativeSource="{RelativeSource Self}" Path="DataContext"/>
                                <Binding ElementName="ViewRoot" Path="DataContext.CurrentLowestPriceSellOrder" FallbackValue="{x:Null}"/>
                            </MultiBinding>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="adorners:Info.Template">
                        <Setter.Value>
                            <ControlTemplate>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <AdornedElementPlaceholder Grid.Row="0"/>
                                    <Rectangle HorizontalAlignment="Stretch" Fill="{DynamicResource PrimaryBrush3}" Height="1"
                                               Grid.Row="1"/>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </DataGrid.RowStyle>
        </DataGrid>

        <GridSplitter Grid.Row="2"
                      DockPanel.Dock="Top" 
                      Style="{StaticResource GridSplitterHorizon}"/>
        
        <DataGrid 
            Grid.Row="3"
            IsReadOnly="true"
            ItemsSource="{Binding CurrentItemTradeListView}">
            <DataGrid.Columns>
                <DataGridTextColumn Binding="{Binding Direction, Converter={StaticResource TradeDirection2NameConverter}}"
                                    Header="方向"/>
                <DataGridTextColumn Binding="{Binding TradeVolume}"
                                    Header="成交数量"/>
                <DataGridTextColumn Binding="{Binding TradePrice}"
                                    Header="成交价格"/>
                <DataGridTextColumn Binding="{Binding CreateTimestampMs, Converter={StaticResource TimestampMs2TimeStringConverter}}"
                                    Header="成交时间"
                                    Width="*"/>

            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</UserControl>
