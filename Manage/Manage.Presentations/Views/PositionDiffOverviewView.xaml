<UserControl 
    x:Class="Manage.Presentations.Views.PositionDiffOverviewView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
    xmlns:convert="clr-namespace:XueQiaoFoundation.BusinessResources.Converters;assembly=XueQiaoFoundation.BusinessResources"
    xmlns:uiextra_convert="clr-namespace:XueQiaoFoundation.UI.Extra.converter;assembly=XueQiaoFoundation.UI.Extra"
    xmlns:adjust="clr-namespace:xueqiao.trade.hosting.position.adjust.thriftapi;assembly=IDLAutoGenerated"
    mc:Ignorable="d" 
    d:DesignHeight="600" d:DesignWidth="1000"
    FontSize="{DynamicResource PrimaryContentFontSize}"
    Background="{DynamicResource RootBgBrush}"
    x:Name="ViewRoot">
    <UserControl.Resources>
        <convert:VerifyStatus2NameConverter x:Key="VerifyStatus2NameConverter"/>
        <uiextra_convert:Timestamp2StringConverter x:Key="Second2DateTimeStr" Convert2StringFormatType="DateTime" ValueType="Second"/>
        <uiextra_convert:Timestamp2StringConverter x:Key="Second2DayStr" Convert2StringFormatType="Date" ValueType="Second"/>
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="1.5*"/>
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <DockPanel Grid.Row="0" VerticalAlignment="Center">
                <TextBlock DockPanel.Dock="Left" VerticalAlignment="Center"
                           Text="实时净仓对比："/>
                <StackPanel DockPanel.Dock="Right" HorizontalAlignment="Right"
                            Orientation="Horizontal">
                    <TextBlock 
                        VerticalAlignment="Center"
                        Margin="15,0,0,0">
                        <Run>（刷新时间:</Run>
                        <Run Text="{Binding RealtimeDiffRefreshTimestamp, Converter={StaticResource Second2DateTimeStr}, TargetNullValue={StaticResource NullValueDataDefaultDisplayText}}"/>
                        <Run>）</Run>
                    </TextBlock>
                    <Button  
                        VerticalAlignment="Center"
                        Content="刷新" Style="{StaticResource FlatContentButtonPrimary3}"
                        Margin="15,0,0,0"
                        Command="{Binding RefreshRealtimeDiffCmd}"/>
                </StackPanel>
            </DockPanel>
            <DataGrid Grid.Row="1" Margin="0,4,0,0"
                      SelectionMode="Single"
                      SelectedItem="{Binding SelectedRealtimeDiffItem, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      ItemsSource="{Binding RealtimeDiffCollectionView}">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="合约" Width="*"
                                        Binding="{Binding ContractDetailContainer.CnDisplayName}"/>
                    <DataGridTextColumn Header="资金账户净仓" Width="*"
                                        Binding="{Binding UpsideNetPosition}"/>
                    <DataGridTextColumn Header="雪橇汇总净仓" Width="*"
                                        Binding="{Binding SledNetPosition}"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <GridSplitter Grid.Column="1" Style="{StaticResource GridSplitterVertical}" Background="{x:Null}"/>

        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <DockPanel Grid.Row="0" VerticalAlignment="Center">
                <TextBlock DockPanel.Dock="Left" VerticalAlignment="Center"
                           Text="合约每日成交净仓对比："/>
                <HeaderedContentControl DockPanel.Dock="Right" HorizontalAlignment="Right" Margin="8,0,0,0" VerticalAlignment="Center"
                                        Header="合约："
                                        Style="{StaticResource HorizonalOrientationFieldHeaderedStyle}">
                    <StackPanel x:Name="SelectContractContainerPanel" Orientation="Horizontal">
                        <TextBlock 
                            MaxWidth="200"
                            Text="{Binding DailyDiffSelectedContractContainer.CnDisplayName, Mode=OneWay}"
                            ToolTip="{Binding RelativeSource={RelativeSource Self}, Path=Text}"/>
                        <!--<TextBox 
                            MinWidth="120" MaxWidth="200" ScrollViewer.HorizontalScrollBarVisibility="Hidden" IsReadOnly="True" 
                            Text="{Binding DailyDiffSelectedContractContainer.CnDisplayName, Mode=OneWay}"
                            ToolTip="{Binding RelativeSource={RelativeSource Self}, Path=Text}"/>-->
                        <Button Margin="8,0,0,0" Content="选择" Style="{StaticResource FlatContentButtonPrimary3}"
                            Command="{Binding TriggerDailyDiffSelectedContractCmd}"
                            CommandParameter="{Binding ElementName=SelectContractContainerPanel}"/>

                        <Button Margin="20,0,0,0" Content="刷新" Style="{StaticResource FlatContentButtonPrimary3}"
                                Command="{Binding RefreshDailyDiffListCmd}"/>
                    </StackPanel>
                </HeaderedContentControl>
            </DockPanel>
            
            <DataGrid Grid.Row="1" Margin="0,4,0,0"
                      ItemsSource="{Binding DailyDiffs}">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="日期" MinWidth="80"
                                        Binding="{Binding DateSec, Converter={StaticResource Second2DayStr}}"/>
                    <DataGridTextColumn Header="资金账户成交净仓"
                                        Binding="{Binding UpsideNetPosition}"/>
                    <DataGridTextColumn Header="雪橇成交净仓"
                                        Binding="{Binding SledNetPosition}"/>
                    <DataGridTextColumn Header="雪橇录入净仓"
                                        Binding="{Binding InputNetPosition}"/>
                    <DataGridTextColumn Header="雪橇汇总净仓"
                                        Binding="{Binding SumNetPosition}"/>
                    <DataGridTemplateColumn Header="核对">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button 
                                    Content="核对" Style="{StaticResource FlatContentButtonPrimary3}"
                                    Command="{Binding ElementName=ViewRoot, Path=DataContext.ToVerifyDailyDiffCmd}"
                                    CommandParameter="{Binding}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="核对备注" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <DataTemplate.Resources>
                                    <Style TargetType="TextBlock" x:Key="VerifyStatusText">
                                        <Setter Property="Foreground" Value="{DynamicResource MinorBrush1}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding VerifyStatus}" Value="{x:Static adjust:VerifyStatus.VERIFY_COMPLETE}">
                                                <Setter Property="Foreground" Value="{DynamicResource ContentBrush1}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataTemplate.Resources>
                                <WrapPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding VerifyStatus, Converter={StaticResource VerifyStatus2NameConverter}}" Style="{StaticResource VerifyStatusText}"/>
                                    <TextBlock Margin="10,0,0,0" Text="{Binding Note}"/>
                                </WrapPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</UserControl>
