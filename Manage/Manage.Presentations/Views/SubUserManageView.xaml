<UserControl x:Class="Manage.Presentations.Views.SubUserManageView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:convert="clr-namespace:XueQiaoFoundation.BusinessResources.Converters;assembly=XueQiaoFoundation.BusinessResources"
             xmlns:trade_hosting="clr-namespace:xueqiao.trade.hosting;assembly=IDLAutoGenerated"
             mc:Ignorable="d" 
             d:DesignWidth="800" 
             d:DesignHeight="300" 
             Background="{DynamicResource RootBgBrush}"
             x:Name="PageRoot">

    <UserControl.Resources>
        <convert:HostingUserStateToDisplayNameConverter x:Key="HostingUserStateToDisplayNameConverter"/>
        <convert:HostingUserRole2DisplayNameConverter x:Key="HostingUserRole2DisplayNameConverter"/>
    </UserControl.Resources>

    <DockPanel Margin="15,15,15,0" LastChildFill="True">
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8" HorizontalAlignment="Left">
            <Button Content="刷新"
                    Style="{StaticResource FlatBgButtonPrimary3}"
                    VerticalAlignment="Center"
                    Command="{Binding ToRefreshListCmd}"/>
        </StackPanel>
        <ContentControl DockPanel.Dock="Bottom" Margin="0, 10" 
                        HorizontalAlignment="Center"
                        Content="{Binding PagerContentView}"/>
        <DataGrid DockPanel.Dock="Top"
                  IsSynchronizedWithCurrentItem="True"
                  ItemsSource="{Binding SubUserItems}"
                  IsReadOnly="True"
                  SelectionUnit="FullRow"
                  Tag="{Binding}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="用户名" Binding="{Binding UserMeta.LoginName}" MinWidth="100"/>
                <DataGridTextColumn Header="姓名" Binding="{Binding UserMeta.NickName}" MinWidth="100"/>
                <DataGridTextColumn Header="权限" Binding="{Binding UserMeta.UserRoleValue, Converter={StaticResource HostingUserRole2DisplayNameConverter}}"
                                    MinWidth="100"/>
                <DataGridTextColumn Header="手机" Binding="{Binding UserMeta.Phone}" MinWidth="80"/>
                <DataGridTextColumn Header="邮箱" Binding="{Binding UserMeta.Email}" MinWidth="80"/>
                <DataGridTextColumn Header="状态" Binding="{Binding UserMeta.UserState, Converter={StaticResource HostingUserStateToDisplayNameConverter}}" MinWidth="50"/>
                <DataGridTemplateColumn Header="可用的操作账户"  Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ItemsControl ItemsSource="{Binding RelatedToSubAccounts}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal" IsItemsHost="True"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="{x:Type trade_hosting:HostingSubAccountRelatedItem}">
                                        <TextBlock>
                                            <Run x:Name="Semicolon" Text=";"/>
                                            <Run>
                                                <MultiBinding StringFormat="{}{0}({1})">
                                                    <Binding Path="SubAccountId"/>
                                                    <Binding Path="SubAccountName"/>
                                                </MultiBinding>
                                            </Run>
                                        </TextBlock>
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource PreviousData}}" Value="{x:Null}">
                                                <Setter TargetName="Semicolon" Property="Text" Value="{x:Null}"/>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</UserControl>
