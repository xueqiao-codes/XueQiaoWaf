<UserControl x:Class="Manage.Presentations.Views.FundAccountManageView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:convert="clr-namespace:XueQiaoFoundation.BusinessResources.Converters;assembly=XueQiaoFoundation.BusinessResources"
             xmlns:trade_hosting="clr-namespace:xueqiao.trade.hosting;assembly=IDLAutoGenerated"
             mc:Ignorable="d" 
             d:DesignHeight="300"
             Background="{DynamicResource RootBgBrush}">
    <UserControl.Resources>
        <convert:HostingTradeAccountField2DisplayConverter x:Key="HostingTradeAccountField2DisplayConverter"/>
    </UserControl.Resources>
    <DockPanel Margin="15,15,15,0" LastChildFill="True">
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8" HorizontalAlignment="Left" >
            <Button Content="+新建资金账户" 
                    Command="{Binding ToAddAccountCmd}" 
                    Style="{StaticResource FlatBgButtonPrimary3}"
                    VerticalAlignment="Center"/>
            <Button Margin="8,0,0,0" 
                    Content="刷新"
                    Style="{StaticResource FlatBgButtonPrimary3}"
                    VerticalAlignment="Center"
                    Command="{Binding ToRefreshListCmd}"/>
        </StackPanel>

        <ContentControl DockPanel.Dock="Bottom" Margin="0, 10" 
                        HorizontalAlignment="Center"
                        Content="{Binding PagerContentView}"/>
        
        <DataGrid DockPanel.Dock="Top"
                  ItemsSource="{Binding TradeAccountItems}"
                  IsReadOnly="True"
                  SelectionUnit="FullRow"
                  Tag="{Binding}">
            <!-- item data type: FundAccountModel -->
            <DataGrid.Columns>
                <DataGridTextColumn Header="券商（经纪商）" 
                                    Binding="{Binding BrokerName}"
                                    MinWidth="100"/>
                <DataGridTextColumn Header="交易接口"
                                    Binding="{Binding AccountMeta.BrokerTechPlatform, Converter={StaticResource HostingTradeAccountField2DisplayConverter}, ConverterParameter={x:Static convert:HostingUser2DisplayField.BrokerTechPlatform}}"
                                    MinWidth="100"/>
                <DataGridTextColumn Header="席位" Binding="{Binding BrokerAccessName}"
                                    MinWidth="100"/>
                <DataGridTextColumn Header="账号" Binding="{Binding AccountMeta.LoginUserName}"
                                    MinWidth="100"/>
                <DataGridTextColumn Header="账户简称" Binding="{Binding AccountMeta.TradeAccountRemark}"
                                    MinWidth="100"/>
                <DataGridTextColumn Header="账号状态"
                                    Binding="{Binding AccountMeta.AccountState, Converter={StaticResource HostingTradeAccountField2DisplayConverter}, ConverterParameter={x:Static convert:HostingUser2DisplayField.TradeAccountState}}"
                                    MinWidth="100"/>
                <DataGridTextColumn Header="接入状态" 
                                    Binding="{Binding AccountMeta.AccountAccessState, Converter={StaticResource HostingTradeAccountField2DisplayConverter}, ConverterParameter={x:Static convert:HostingUser2DisplayField.TradeAccountAccessState}}"
                                    MinWidth="100"/>
                <DataGridTextColumn Header="不可用原因"
                                    Binding="{Binding AccountMeta.InvalidReason}"
                                    Width="*"/>
                <DataGridTextColumn Width="*"/>
                <DataGridTemplateColumn Header="附加信息" CanUserSort="False" 
                                        MinWidth="60"
                                        MaxWidth="400" >
                    <DataGridTemplateColumn.HeaderTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="附加信息" VerticalAlignment="Center"/>
                                <Button VerticalAlignment="Center" Margin="6,0,0,0" 
                                        Style="{StaticResource CornerTipButton}"
                                        Content="?"
                                        ToolTip="由相应券商提供"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.HeaderTemplate>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="查看" 
                                    Command="{Binding Path=Tag.ShowExtraInfoCmd, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"
                                    Style="{StaticResource FlatContentButtonPrimary3}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="启停" CanUserSort="False" 
                                        MinWidth="50"
                                        HeaderStyle="{StaticResource DataGridColumnHeader_HorizontalAlignCenter}">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="10,0">
                                <Button Content="启用" x:Name="ToEnableButn" Visibility="Visible"
                                        Command="{Binding Path=Tag.ToEnableCmd, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource FlatContentButtonPrimary3}"/>
                                <Button Content="停用" x:Name="ToDisableButn" Visibility="Collapsed"
                                            Command="{Binding Path=Tag.ToDisableCmd, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"
                                        Style="{StaticResource FlatContentButtonPrimary3}"/>
                            </StackPanel>
                            <DataTemplate.Triggers>
                                <DataTrigger Binding="{Binding AccountMeta.AccountState}" Value="{x:Static trade_hosting:TradeAccountState.ACCOUNT_NORMAL}">
                                    <Setter TargetName="ToEnableButn" Property="Visibility" Value="Collapsed"/>
                                    <Setter TargetName="ToDisableButn" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="编辑" CanUserSort="False" 
                                        MinWidth="50"
                                        HeaderStyle="{StaticResource DataGridColumnHeader_HorizontalAlignCenter}">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Style="{StaticResource FlatContentButtonPrimary3}"
                                    Margin="10,0"
                                    Content="编辑"
                                    Command="{Binding Path=Tag.ToEditCmd, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <!--
                <DataGridTemplateColumn Header="删除" CanUserSort="False" 
                                        MinWidth="50"
                                        HeaderStyle="{StaticResource DataGridColumnHeader_HorizontalAlignCenter}">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Style="{StaticResource FlatContentButtonPrimary3}"
                                    Margin="10,0"
                                    Content="删除"
                                    Command="{Binding Path=Tag.ToRmCmd, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                -->
                <DataGridTextColumn Width="*"/>
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</UserControl>
